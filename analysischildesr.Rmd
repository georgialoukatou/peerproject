---
title             : "Peer speech project"
---

```{r setup,  include = FALSE, echo=TRUE, message=FALSE}
library(childesr)
library(dplyr)



transcripts_ <-get_participants()
exclude<-c("Biling", "Clinical", "Clinical-MOR")
d=subset(transcripts_, !(transcripts_$collection_name %in% exclude)) #exclude bilingual and clinical studies

#1 CHECK 1st selection : corpora out of lab, > than 2 speakers
#2 CHECK names not found: BolKuiken, Chroma, Jamaican, Berman, CCLAS, Yamaguchi, Paris, Goadrose, Tsay, Zhou3


outofLab<-c("LeeWongLeung","Beijing","TCCM","Zhou3","ZhouDinner","Tsay", "Jakarta", "Jiwon", "Ryu", "Bloom70", "Braunwald", "Brown", "Clark", "Gleason",  "Hall", "Kuczaj", "Post", "Sachs", "Snow", "Suppes", "Valian","Providence", "Champaud", "Geneva","Goadrose", "Leveille", "Paris", "Pauline", "Yamaguchi", "York", "Caroline", "Leo", "Miller", "Rigol","Wagner", "Plunkett", "Kari", "Ringstad", "Aguirre", "Linaza", "LlinasOjea", "Marrero", "Nieva", "OreaPine", "Ornat", "Romero", "Vila","Soto", "CCLAS", "Argus", "Kohler", "Korgesaar", "Vija", "Zupping", "Family", "Samadi", "Doukas", "BatEl", "Berman", "Levy", "Ravid", "Bodor", "Reger", "Jamaican", "Demuth", "Narasimhan", "Gaeltacht", "Wijnen", "Utrecht", "Stellenbosch", "Belfast", "Forrester", "Lara", "Wells", "Hamasaki", "Ishii", "MiiPro", "Miyata", "Jordina", "Julia", "MireiaEvaPascual", "SerraSole", "Antelmi", "Calambrone", "Klammler", "Roma", "Florianopolis", "Santos", "Avram", "Kovacevic", "Chroma", "Protassova", "Tanja", "SCECL", "BSF", "BolKuiken", "Thomas", "MPI-EVA-Manchester", "Beek") 


cSelect=subset(d, (d$corpus_name %in% outofLab))


i<-1

#verifies if all corpora have at least 3 speakers
for (corpus in unique(cSelect$corpus_name)){
  eachdb=cSelect[cSelect$corpus_name==corpus,]
  if (length(unique(eachdb$role)) < 3) {unique(eachdb$corpus_name) }
}

unique(cSelect$role)
```
Out of the  lab corpora: 
 `r unique(cSelect$corpus_name)` 
 
Number of out of  the lab corpora:  `r length(unique(cSelect$corpus_name))` 

Role tags in all CHILDES : `r unique(cSelect$role) `

```{r child speech corpus, echo=TRUE, message=FALSE}
#finds corpora with peer speech
namePeerSpeech=list()
dataPeer=list()

#3 CHECK: all cousins, boys etc Nnot adults?
childSpeakers=c("Sister", "Brother", "Playmate", "Teenager", "Cousin", "Child", "Girl", "Sibling", "Boy")

cSelectPeer=subset(cSelect, (cSelect$role %in% childSpeakers))
peerCorpusName=unique(cSelectPeer$corpus_name)



```
Out of lab CHILDES corpora with child speech (tags= `r head(childSpeakers)`):  `r peerCorpusName` 

Number of CHILDES corpora with peer speech: `r length(peerCorpusName)`

```{r read_csv, eval=FALSE, echo = TRUE, message=FALSE} 
# counts number of utterances per speaker for the selected out-of-lab corpora
#This chunk takes time to compute!


#for (name in peerCorpusName[1:2]) {   #choosing only first 2 corpora to have it compile faster! 

i=1
total<-data.frame(speaker_role=unique(cSelect$role))

for (name in peerCorpusName) {   #choosing only first 2 corpora to have it compile faster! 
  i=i+1
  utts<-get_utterances(corpus=name)
  ex=data.frame()
  ex<- utts %>% group_by(speaker_role) %>% tally()
  ex$n <- as.numeric(as.character(ex$n)) / sum(ex$n)
  total<- left_join(total, ex )
  colnames(total)[i]<-name
}
total[is.na(total)] <- 0
total$Rmean <-rowMeans(total[2:3])
total$Rsd <- apply(total[2:3], 1, sd)
total$Rmean<- round(total$Rmean, 2)
total$Rsd<- round(total$Rsd, 2)
total

total_specific<- total  %>% select(speaker_role, Rmean, Rsd)

total_specific<- subset(total_specific, !(total_specific$Rmean==0))

library(ggplot2)
p<-ggplot(total_specific, aes(x=speaker_role, y=Rmean, fill=speaker_role)) + geom_bar(stat="identity") + labs(title="Mean input ratio across CHILDES", x="Speaker role", y = "Mean input ratio")
p

```

Per corpus Number of utterances per speaker for CHILDES corpora with peer speech: (see table)
Total Number of utterances per speaker for CHILDES corpora with peer speech: (see nuttsSummary)

```{r wireless, eval=FALSE, include=TRUE, message=FALSE, echo=TRUE}
# counts number of utterances per speaker for the selected out-of-lab corpora with wireless recordings

tablew=data.frame()

#4 CHECK if only these
wirelessCorpusName<-c("Wells", "Demuth", "Hall")

i=1
for (name in wirelessCorpusName) {
  cw<-get_utterances(corpus=name)
  tabletmp<-cw %>% group_by(speaker_role) %>% summarise(no_rows = length(speaker_role))
  tablew<-rbind(tablew, tabletmp)
  i=i+1}
tablew

nuttsWirelessSummary<-tablew %>% group_by(speaker_role) %>% summarise(no_rows = sum(no_rows))
nuttsWirelessSummary
```

Per corpus Number of utterances per speaker for CHILDES corpora with peer speech AND wireless recordings: (see tablew)
Total Number of utterances per speaker for CHILDES corpora with peer speech AND wireless recordings: (see nuttsWirelessSummary)

