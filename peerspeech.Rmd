---
title             : "Peer speech project"
---

```{r setup, include = FALSE, echo=TRUE, message=FALSE}
library(childesr)
library(dplyr)


transcripts_ <-get_participants()
exclude<-c("Biling", "Clinical", "Clinical-MOR")
d=subset(transcripts_, !(transcripts_$collection_name %in% exclude)) #exclude bilingual and clinical studies

#1 CHECK 1st selection : corpora out of lab, > than 2 speakers
#2 CHECK names not found: BolKuiken, Chroma, Jamaican, Berman, CCLAS, Yamaguchi, Paris, Goadrose, Tsay, Zhou3


outofLab<-c("LeeWongLeung","Beijing","TCCM","Zhou3","ZhouDinner","Tsay", "Jakarta", "Jiwon", "Ryu", "Bloom70", "Braunwald", "Brown", "Clark", "Gleason",  "Hall", "Kuczaj", "Post", "Sachs", "Snow", "Suppes", "Valian","Providence", "Champaud", "Geneva","Goadrose", "Leveille", "Paris", "Pauline", "Yamaguchi", "York", "Caroline", "Leo", "Miller", "Rigol","Wagner", "Plunkett", "Kari", "Ringstad", "Aguirre", "Linaza", "LlinasOjea", "Marrero", "Nieva", "OreaPine", "Ornat", "Romero", "Vila","Soto", "CCLAS", "Argus", "Kohler", "Korgesaar", "Vija", "Zupping", "Family", "Samadi", "Doukas", "BatEl", "Berman", "Levy", "Ravid", "Bodor", "Reger", "Jamaican", "Demuth", "Narasimhan", "Gaeltacht", "Wijnen", "Utrecht", "Stellenbosch", "Belfast", "Forrester", "Lara", "Wells", "Hamasaki", "Ishii", "MiiPro", "Miyata", "Jordina", "Julia", "MireiaEvaPascual", "SerraSole", "Antelmi", "Calambrone", "Klammler", "Roma", "Florianopolis", "Santos", "Avram", "Kovacevic", "Chroma", "Protassova", "Tanja", "SCECL", "BSF", "BolKuiken", "Thomas", "MPI-EVA-Manchester", "Beek") 


cSelect=subset(d, (d$corpus_name %in% outofLab))


i<-1

#verifies if all corpora have at least 3 speakers
for (corpus in unique(cSelect$corpus_name)){
  eachdb=cSelect[cSelect$corpus_name==corpus,]
  if (length(unique(eachdb$role)) < 3) {unique(eachdb$corpus_name) }
}

unique(cSelect$role)
```
Out of the  lab corpora: 
 `r unique(cSelect$corpus_name)` 
 
Number of out of  the lab corpora:  `r length(unique(cSelect$corpus_name))` 

Role tags in all CHILDES : `r unique(cSelect$role) `

```{r child speech corpus, echo=TRUE, message=FALSE}
#finds corpora with peer speech
namePeerSpeech=list()
dataPeer=list()

#3 CHECK: all cousins, boys etc Nnot adults?
childSpeakers=c("Sister", "Brother", "Playmate", "Teenager", "Cousin", "Child", "Girl", "Sibling", "Boy")

cSelectPeer=subset(cSelect, (cSelect$role %in% childSpeakers))
peerCorpusName=unique(cSelectPeer$corpus_name)



```
Out of lab CHILDES corpora with child speech (tags= `r head(childSpeakers)`):  `r peerCorpusName` 

Number of CHILDES corpora with peer speech: `r length(peerCorpusName)`

```{r read_csv, eval=TRUE, echo = TRUE, message=FALSE} 
# counts number of utterances per speaker for the selected out-of-lab corpora
#This chunk takes time to compute!
tablep=data.frame()

i=1
for (name in peerCorpusName[1:5]) {   #choosing only first 5 corpora to have it compile faster! 
  cp<-get_utterances(corpus=name)
  tabletmp_<-cp %>% group_by(speaker_role) %>% summarise(no_rows = length(speaker_role))
  tablep<-rbind(tablep, tabletmp_)
  i=i+1}
tablep

nuttsSummary<-tablep %>% group_by(speaker_role) %>% summarise(no_rows = sum(no_rows))
nuttsSummary


```

Per corpus Number of utterances per speaker for CHILDES corpora with peer speech: (see table)
Total Number of utterances per speaker for CHILDES corpora with peer speech: (see nuttsSummary)

```{r wireless, include=TRUE, message=FALSE, echo=TRUE}
# counts number of utterances per speaker for the selected out-of-lab corpora with wireless recordings

tablew=data.frame()

#4 CHECK if only these
wirelessCorpusName<-c("Wells", "Demuth", "Hall")

i=1
for (name in wirelessCorpusName) {
  cw<-get_utterances(corpus=name)
  tabletmp<-cw %>% group_by(speaker_role) %>% summarise(no_rows = length(speaker_role))
  tablew<-rbind(tablew, tabletmp)
  i=i+1}
tablew

nuttsWirelessSummary<-tablew %>% group_by(speaker_role) %>% summarise(no_rows = sum(no_rows))
nuttsWirelessSummary
```

Per corpus Number of utterances per speaker for CHILDES corpora with peer speech AND wireless recordings: (see tablew)
Total Number of utterances per speaker for CHILDES corpora with peer speech AND wireless recordings: (see nuttsWirelessSummary)



```{r demuthandwells, include=TRUE, message=FALSE}

###5 CHECK: memory processing problems for googlesheets library

#reads demnuth corpus and counts utterances per speaker
demuth<-read.csv(file="/Users/lscpuser/Downloads/Sesotho_CDI_last.csv", header=TRUE)
sesotho_speakers<- demuth %>% group_by(speaker_role_raw) %>% summarise(no_rows = length(speaker_role_raw))
sesotho_speakers<- sesotho_speakers %>%   arrange(desc(no_rows))
sesotho_speakers

demuth_ntc<-subset(demuth, !(demuth$speaker_role_raw == "Target_Child" ))
demuth_notdirected<-subset(demuth_ntc, !(demuth_ntc$childdirected=="1"))
demuth_directed<-subset(demuth_ntc, (demuth_ntc$childdirected=="1"))

#counts child directed utterances per speaker
sesotho_speakers_directed<- demuth_directed %>% group_by(speaker_role_raw) %>% summarise(no_rows = length(speaker_role_raw))
sesotho_speakers_directed<- sesotho_speakers_directed %>%   arrange(desc(no_rows))
sesotho_speakers_directed #has child directed number of utts per speaker

#matches addressee with speaker role
directed<- as.data.frame(demuth %>% group_by(childdirected) %>% summarise(no_rows = length(childdirected)))
speaker_info<- as.data.frame(unique(demuth %>%select(speaker_id, speaker_role_raw, speaker_age, speaker_gender)))
directed_speaker_info<-merge(x=directed, y=speakers_info, by.x="childdirected", by.y="speaker_id", all.x=TRUE, sort=TRUE)
directed_speaker_info<- directed_speaker_info %>%   arrange(desc(no_rows))
directed_speaker_info

#Wells
#number of utterances per speaker
wells<-read.csv(file="/Users/lscpuser/Documents/peerproject/peerproject/output2.csv", header=FALSE, sep=";")
names(wells)<-c("speaker", "utterance", "directed")
wells_speakers<- wells %>% group_by(speaker) %>% summarise(no_rows = length(speaker))
wells_speakers<- wells_speakers %>%   arrange(desc(no_rows))
wells_speakers

#child directed n of utterances
wells_directed<- wells %>% group_by(directed) %>% summarise(no_rows = length(directed))
wells_directed<- wells_directed %>% as_tibble %>%   arrange(desc(no_rows))
wells_directed<- wells_directed %>%   arrange(desc(no_rows))
wells_directed

```

Utterances per speaker Demuth corpus : see sesotho_speakers
Utterances per speaker Demuth corpus with  directed annotation : see sesotho_directed_si

Utterances per speaker Wells corpus  : see wells_speakers
Utterances per speaker Wells corpus with directed  annotation : see wells_directed

