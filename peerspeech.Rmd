---
title             : "Peer speech project"
---

```{r setup,  include = FALSE, echo=TRUE, message=FALSE}
library(childesr)
library(dplyr)


transcripts_ <-get_participants()
exclude<-c("Biling", "Clinical", "Clinical-MOR")
d=subset(transcripts_, !(transcripts_$collection_name %in% exclude)) #exclude bilingual and clinical studies

#1 CHECK 1st selection : corpora out of lab, > than 2 speakers
#2 CHECK names not found: BolKuiken, Chroma, Jamaican, Berman, CCLAS, Yamaguchi, Paris, Goadrose, Tsay, Zhou3


outofLab<-c("LeeWongLeung","Beijing","TCCM","Zhou3","ZhouDinner","Tsay", "Jakarta", "Jiwon", "Ryu", "Bloom70", "Braunwald", "Brown", "Clark", "Gleason",  "Hall", "Kuczaj", "Post", "Sachs", "Snow", "Suppes", "Valian","Providence", "Champaud", "Geneva","Goadrose", "Leveille", "Paris", "Pauline", "Yamaguchi", "York", "Caroline", "Leo", "Miller", "Rigol","Wagner", "Plunkett", "Kari", "Ringstad", "Aguirre", "Linaza", "LlinasOjea", "Marrero", "Nieva", "OreaPine", "Ornat", "Romero", "Vila","Soto", "CCLAS", "Argus", "Kohler", "Korgesaar", "Vija", "Zupping", "Family", "Samadi", "Doukas", "BatEl", "Berman", "Levy", "Ravid", "Bodor", "Reger", "Jamaican", "Demuth", "Narasimhan", "Gaeltacht", "Wijnen", "Utrecht", "Stellenbosch", "Belfast", "Forrester", "Lara", "Wells", "Hamasaki", "Ishii", "MiiPro", "Miyata", "Jordina", "Julia", "MireiaEvaPascual", "SerraSole", "Antelmi", "Calambrone", "Klammler", "Roma", "Florianopolis", "Santos", "Avram", "Kovacevic", "Chroma", "Protassova", "Tanja", "SCECL", "BSF", "BolKuiken", "Thomas", "MPI-EVA-Manchester", "Beek") 


cSelect=subset(d, (d$corpus_name %in% outofLab))


i<-1

#verifies if all corpora have at least 3 speakers
for (corpus in unique(cSelect$corpus_name)){
  eachdb=cSelect[cSelect$corpus_name==corpus,]
  if (length(unique(eachdb$role)) < 3) {unique(eachdb$corpus_name) }
}

unique(cSelect$role)
```
Out of the  lab corpora: 
 `r unique(cSelect$corpus_name)` 
 
Number of out of  the lab corpora:  `r length(unique(cSelect$corpus_name))` 

Role tags in all CHILDES : `r unique(cSelect$role) `

```{r child speech corpus, echo=TRUE, message=FALSE}
#finds corpora with peer speech
namePeerSpeech=list()
dataPeer=list()

#3 CHECK: all cousins, boys etc Nnot adults?
childSpeakers=c("Sister", "Brother", "Playmate", "Teenager", "Cousin", "Child", "Girl", "Sibling", "Boy")

cSelectPeer=subset(cSelect, (cSelect$role %in% childSpeakers))
peerCorpusName=unique(cSelectPeer$corpus_name)



```
Out of lab CHILDES corpora with child speech (tags= `r head(childSpeakers)`):  `r peerCorpusName` 

Number of CHILDES corpora with peer speech: `r length(peerCorpusName)`

```{r read_csv, eval=FALSE, echo = TRUE, message=FALSE} 
# counts number of utterances per speaker for the selected out-of-lab corpora
#This chunk takes time to compute!
tablep=data.frame()

i=1
for (name in peerCorpusName[1:2]) {   #choosing only first 2 corpora to have it compile faster! 
  cp<-get_utterances(corpus=name)
  tabletmp_<-cp %>% group_by(speaker_role) %>% summarise(no_rows = length(speaker_role))
  tablep<-rbind(tablep, tabletmp_)
  i=i+1}
tablep

nuttsSummary<-tablep %>% group_by(speaker_role) %>% summarise(no_rows = sum(no_rows))
nuttsSummary


```

Per corpus Number of utterances per speaker for CHILDES corpora with peer speech: (see table)
Total Number of utterances per speaker for CHILDES corpora with peer speech: (see nuttsSummary)

```{r wireless, eval=FALSE, include=TRUE, message=FALSE, echo=TRUE}
# counts number of utterances per speaker for the selected out-of-lab corpora with wireless recordings

tablew=data.frame()

#4 CHECK if only these
wirelessCorpusName<-c("Wells", "Demuth", "Hall")

i=1
for (name in wirelessCorpusName) {
  cw<-get_utterances(corpus=name)
  tabletmp<-cw %>% group_by(speaker_role) %>% summarise(no_rows = length(speaker_role))
  tablew<-rbind(tablew, tabletmp)
  i=i+1}
tablew

nuttsWirelessSummary<-tablew %>% group_by(speaker_role) %>% summarise(no_rows = sum(no_rows))
nuttsWirelessSummary
```

Per corpus Number of utterances per speaker for CHILDES corpora with peer speech AND wireless recordings: (see tablew)
Total Number of utterances per speaker for CHILDES corpora with peer speech AND wireless recordings: (see nuttsWirelessSummary)



```{r demuth, eval=TRUE, include=TRUE, message=FALSE}

lang<-"Sesotho"

#reads demuth corpus and counts utterances per speaker
demuth<-read.csv(file="sesotho_emilie_CDI.csv", header=TRUE) # memory processing problems, can't load googlesheets library
sesotho_speakers<- demuth %>% group_by(role_raw) %>% summarise(no_rows = length(role_raw))
sesotho_speakers<- sesotho_speakers %>%   arrange(desc(no_rows))
sesotho_speakers<-as.data.frame(sesotho_speakers)
sesotho_speakers_input<-subset(sesotho_speakers, !(sesotho_speakers$role_raw=="Target_Child")) # speaker category  and n of utts per speaker
sesotho_speakers_input


total_input<-sum(sesotho_speakers_input$no_rows)

#mother input:
sesotho_mother<-subset(sesotho_speakers_input, (sesotho_speakers_input$role_raw=="Mother"))
sesotho_mother$no_rows/total_input

#siblings input:
sesotho_siblings<-subset(sesotho_speakers_input, (sesotho_speakers_input$role_raw=="Sister" |sesotho_speakers_input$role_raw=="Brother" ))
sum(sesotho_siblings$no_rows/total_input)

#other children input:
sesotho_peers<-subset(sesotho_speakers_input, (sesotho_speakers_input$role_raw=="Cousin" |sesotho_speakers_input$role_raw=="Playmate" | sesotho_speakers_input$role_raw=="Teenager"   ))
sum(sesotho_peers$no_rows/total_input)

#other adult input:
sesotho_adults<-subset(sesotho_speakers_input, ( sesotho_speakers_input$role_raw=="Grandmother" | sesotho_speakers_input$role_raw=="Uncle" | sesotho_speakers_input$role_raw=="Adult" |  sesotho_speakers_input$role_raw=="Father"    ))
sum(sesotho_adults$no_rows/total_input)

#annotated utterances by emilie
annotated<-demuth[1:36782,]
annotated_input<-subset(annotated, !(annotated$role_raw=="Target_Child"))
annotated_input$childdirected<-as.factor(annotated_input$childdirected)
total_annotated_input<-length(annotated_input$utterance_id)
annotated_table<- annotated_input %>% group_by(childdirected) %>% summarise(no_rows = length(childdirected))
annotated_table<-as.data.frame(annotated_table)
annotated_table<- annotated_table %>%   arrange(desc(no_rows))
annotated_table



#target  child directed utts
child_directed<-subset(annotated_input, (annotated_input$childdirected=="1"))
cddirected_utts<- as.data.frame(child_directed %>%select(utterance))
#write.table(cddirected_utts, file=paste0("~/Documents/peerproject/peerproject", lang, "childdirected"), row.names=F, col.names=T,  quote=F) 
length(child_directed$utterance)/total_annotated_input #percentage of child directed speech vs total annotated


#matches addressee with speaker role (especially for non-child directed)
speaker_info<- as.data.frame(unique(demuth %>%select(speaker_id, role_raw)))
colnames(speaker_info)[colnames(speaker_info)=="role_raw"] <- "role_adressee"
annotated_speaker_info<-merge(x=annotated_input, y=speaker_info, by.x="childdirected", by.y="speaker_id", all.x=TRUE, sort=TRUE)

#adult directed utts
adult_directed<-subset(annotated_speaker_info, !(annotated_speaker_info$role_adressee=="Playmate"| annotated_speaker_info$role_adressee=="Cousin"|annotated_speaker_info$role_adressee=="?"| annotated_speaker_info$childdirected=="SELF"| annotated_speaker_info$role_adressee=="SELF"| annotated_speaker_info$role_adressee=="Brother"| annotated_speaker_info$childdirected=="NA"| annotated_speaker_info$role_adressee=="Teenager"|annotated_speaker_info$role_adressee=="Sister"|annotated_speaker_info$childdirected=="1"|annotated_speaker_info$childdirected=="0"|annotated_speaker_info$childdirected=="O"))
addirected_utts<- as.data.frame(adult_directed %>%select(utterance))
write.table(addirected_utts, file=paste0("Sesothoadultdirected"), row.names=F, col.names=T,  quote=F) 
length(adult_directed$utterance)/total_annotated_input #percentage of child directed speech vs total annotated

#na directed
na_directed<-subset(annotated_input, (annotated_input$childdirected=="NA" |annotated_input$childdirected=="?"  ))
nadirected_utts<- as.data.frame(na_directed %>%select(utterance))
#write.table(cddirected_utts, file=paste0("~/Documents/peerproject/peerproject", lang, "childdirected"), row.names=F, col.names=T,  quote=F) 
length(na_directed$utterance)/total_annotated_input #percentage of child directed speech vs total annotated



#Sentence  type
sentence_type_child_annotated<- child_directed %>% group_by(sentence_type) %>% summarise(no_rows = length(sentence_type))
directed_questions<-subset(sentence_type_child_annotated, (sentence_type_child_annotated$sentence_type=="question"))
directed_questions$no_rows/sum(sentence_type_child_annotated$no_rows)

sentence_type_adult_annotated<- adult_directed %>% group_by(sentence_type) %>% summarise(no_rows = length(sentence_type))
adultdirected_questions<-subset(sentence_type_adult_annotated, (sentence_type_adult_annotated$sentence_type=="question"))
adultdirected_questions$no_rows/sum(sentence_type_adult_annotated$no_rows)


```


```{r wells, eval=TRUE, include=TRUE, message=FALSE}

#load Wells data

lang<-"English"
wells<-read.csv(file="wells.csv", header=TRUE) #11,866

#remove target child utts  aka 4,830 entries
wells_input<- wells[!grepl("Target", wells$ROLE),] 


#number of utterances per speaker
wells_input_speakers<- wells_input %>% group_by(ROLE) %>% summarise(no_rows = length(ROLE))

#order by number of utt
wells_input_speakers<- wells_input_speakers %>%   arrange(desc(no_rows))

#create a data.frame 
wells_input_speakers<- as.data.frame(wells_input_speakers)
wells_input_speakers  #number of utterances per speaker 


## NUMBER OF UTTERANCW BY SPEAKER


#number  of total input utterances
total_winput<-sum(wells_input_speakers$no_rows) 

#mother input:
wells_mother<-subset(wells_input_speakers, (wells_input_speakers$ROLE=="Mother")) #number of utterances by mothers

# percentage of utterances by mother in total input
wells_mother$no_rows/total_winput *100 #52.11768

#siblings input:
wells_siblings<- wells_input_speakers[grep("Sister|Brother|Sibling", wells_input_speakers$ROLE),] 
sum(wells_siblings$no_rows)/total_winput

#other children input:
wells_chi<- wells_input_speakers[grep("Child|Playmate", wells_input_speakers$ROLE),] 
sum(wells_chi$no_rows)/total_winput

#other adults input:
wells_adu<- wells_input_speakers[grep("Adult|Uncle|Grandmother|Family_Friend|Visitor|Aunt|Father",wells_input_speakers$ROLE),] 
sum(wells_adu$no_rows)/total_winput


#ADRESSEE ANNOTATIONS PART
wells_annotated_input<-subset(wells_input, !(wells_input$DIRECTED=="")) #select utterances annotated by Naomi Alex up to now
wells_annotated_value<- wells_annotated_input %>% group_by(DIRECTED) %>% summarise(no_rows = length(DIRECTED))
wells_annotated_value<-as.data.frame(wells_annotated_value)
wells_total_annotated_input<-sum(wells_annotated_value$no_rows) #annotated adressees and n of utts  
wells_annotated_value

#target  child directed
wells_annotated_CHI<-subset(wells_annotated_input, (wells_annotated_input$DIRECTED=="CHI")) #wells annotated child-directed corpus
length(wells_annotated_CHI$UTTERANCE)/ length(wells_annotated_input$UTTERANCE)    # n of child-directed utterances
cddirected_utts<- as.data.frame(wells_annotated_CHI %>%select(UTTERANCE))
write.table(cddirected_utts, file=paste0( lang,"Wellschilddirected.txt"), row.names=F, col.names=T,  quote=F) 


#adult directed 
adult_directed<-subset(wells_annotated_input, !(wells_annotated_input$DIRECTED=="CHI" |wells_annotated_input$DIRECTED=="0" |wells_annotated_input$DIRECTED=="O" | wells_annotated_input$DIRECTED=="?" | wells_annotated_input$DIRECTED=="SELF"| wells_annotated_input$DIRECTED=="NIC"  | wells_annotated_input$DIRECTED=="TELEPHONE" | wells_annotated_input$DIRECTED=="MIX" | wells_annotated_input$DIRECTED=="LOU" | wells_annotated_input$DIRECTED=="REB" | wells_annotated_input$DIRECTED=="PET"| wells_annotated_input$DIRECTED=="RAC" | wells_annotated_input$DIRECTED=="CHR" | wells_annotated_input$DIRECTED=="NA"))
addirected_utts<- as.data.frame(adult_directed %>%select(UTTERANCE))
write.table(addirected_utts, file=paste0(lang, "Wellsadultdirected.txt"), row.names=F, col.names=T,  quote=F) 

length(addirected_utts$UTTERANCE)/ length(wells_annotated_input$UTTERANCE)    # n of child-directed utterances

#NA annotations
wells_annotated_na <- subset(wells_annotated_input,(wells_annotated_input$DIRECTED=="?"|wells_annotated_input$DIRECTED=="NA"|wells_annotated_input$DIRECTED==""|wells_annotated_input$DIRECTED==" "))
length(wells_annotated_na$UTTERANCE)/ length(wells_annotated_input$UTTERANCE) 

```

```{r figure making, eval=TRUE, include=TRUE, message=FALSE}
#install libraries
library(ggplot2)









```
